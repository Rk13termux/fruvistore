<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Funciones Disponibles</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        #results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>üîß Debug - Funciones de Supabase Disponibles</h1>
    
    <div class="debug-section">
        <h2>üöÄ Funciones Cr√≠ticas</h2>
        <button onclick="checkCriticalFunctions()">Verificar Funciones Cr√≠ticas</button>
        <button onclick="checkAllWindowFunctions()">Ver Todas las Funciones</button>
        <button onclick="checkFileLoading()">Verificar Carga de Archivos</button>
        <div id="results"></div>
    </div>

    <div class="debug-section">
        <h2>üí° Soluciones R√°pidas</h2>
        <button onclick="showQuickFixes()">Mostrar Soluciones</button>
        <button onclick="runAutomaticFix()">Ejecutar Correcci√≥n Autom√°tica</button>
        <div id="fixes" style="margin-top: 15px;"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            results.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function checkCriticalFunctions() {
            clearResults();
            log('üîç === VERIFICANDO FUNCIONES CR√çTICAS ===');
            
            const criticalFunctions = [
                'signInWithEmail',
                'signUpWithEmail',
                'getUser',
                'getUserStatus',
                'setupSupabase',
                'checkSupabaseConfig'
            ];

            criticalFunctions.forEach(func => {
                const available = typeof window[func] === 'function';
                const status = available ? '‚úÖ DISPONIBLE' : '‚ùå NO DISPONIBLE';
                log(`${status} - ${func}`, available ? 'success' : 'error');
            });
        }

        function checkAllWindowFunctions() {
            clearResults();
            log('üîç === VERIFICANDO TODAS LAS FUNCIONES EN WINDOW ===');
            
            const allFunctions = Object.keys(window)
                .filter(key => typeof window[key] === 'function')
                .filter(key => key.toLowerCase().includes('supabase') || 
                              key.toLowerCase().includes('sign') || 
                              key.toLowerCase().includes('user'))
                .sort();

            if (allFunctions.length === 0) {
                log('‚ùå No se encontraron funciones relacionadas con Supabase', 'error');
            } else {
                log(`‚úÖ Se encontraron ${allFunctions.length} funciones relacionadas:`, 'success');
                allFunctions.forEach(func => log(`   - ${func}`));
            }
        }

        function checkFileLoading() {
            clearResults();
            log('üîç === VERIFICANDO CARGA DE ARCHIVOS ===');
            
            // Verificar si supabaseService.js est√° cargado
            const scripts = document.querySelectorAll('script[src*="supabaseService"]');
            if (scripts.length > 0) {
                log(`‚úÖ supabaseService.js cargado (${scripts.length} instancia(s))`, 'success');
                scripts.forEach((script, index) => {
                    log(`   Archivo ${index + 1}: ${script.src}`);
                });
            } else {
                log('‚ùå supabaseService.js NO est√° cargado en la p√°gina', 'error');
            }
        }

        function showQuickFixes() {
            const fixes = document.getElementById('fixes');
            fixes.innerHTML = `
                <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin: 10px 0;">
                    <h3>üí° Soluciones R√°pidas:</h3>
                    <ol>
                        <li><strong>Recargar la p√°gina</strong> - Las funciones podr√≠an no cargarse correctamente</li>
                        <li><strong>Verificar consola</strong> - Buscar errores de carga de archivos</li>
                        <li><strong>Ejecutar correcci√≥n autom√°tica</strong> - Usar el bot√≥n de abajo</li>
                        <li><strong>Verificar conexi√≥n</strong> - Asegurar que supabaseService.js est√© incluido</li>
                    </ol>
                </div>
            `;
        }

        function runAutomaticFix() {
            clearResults();
            log('üîß === EJECUTANDO CORRECCI√ìN AUTOM√ÅTICA ===');

            // 1. Verificar funciones actuales
            if (typeof window.signInWithEmail === 'function') {
                log('‚úÖ signInWithEmail ya est√° disponible', 'success');
                return;
            }

            // 2. Intentar recargar si es necesario
            log('üîÑ Verificando si necesitamos recargar archivos...');
            
            // 3. Crear funci√≥n de respaldo si no existe
            if (typeof window.signInWithEmail !== 'function') {
                log('‚ö†Ô∏è Creando funci√≥n de respaldo...', 'warning');
                
                window.signInWithEmail = async function({ email, password }) {
                    log('üö® Usando funci√≥n de respaldo - el archivo principal no se carg√≥ correctamente', 'warning');
                    throw new Error('supabaseService.js no se carg√≥ correctamente. Recarga la p√°gina.');
                };
                
                log('‚úÖ Funci√≥n de respaldo creada', 'success');
            }

            // 4. Mostrar instrucciones
            log('üí° Para solucionar permanentemente:', 'warning');
            log('   1. Abre DevTools (F12) ‚Üí Network', 'warning');
            log('   2. Recarga la p√°gina (Ctrl+R)', 'warning');
            log('   3. Busca "supabaseService.js" en la pesta√±a Network', 'warning');
            log('   4. Si no aparece, hay un problema con la carga del archivo', 'warning');
        }

        // Ejecutar verificaci√≥n autom√°tica al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkCriticalFunctions();
            }, 1000);
        });

        // Hacer funciones disponibles globalmente para consola
        window.debugFunctions = {
            checkCriticalFunctions,
            checkAllWindowFunctions,
            checkFileLoading,
            runAutomaticFix
        };

        log('üöÄ Debug tool cargado. Usa las funciones arriba para diagnosticar.');
        log('üí° Tambi√©n puedes usar window.debugFunctions.checkCriticalFunctions() en consola.');
    </script>
</body>
</html>
